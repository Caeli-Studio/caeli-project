#!/usr/bin/env sh

echo "üöÄ Pre-commit checks starting..."

# Run lint-staged for automatic formatting and linting
echo "üìù Running lint-staged..."
npx lint-staged

# Run type checking
echo "üîç Running type checks..."
npm run type-check

# Check for TODO/FIXME comments in staged files
echo "üìã Checking for TODO/FIXME comments..."
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)' || true)
if [ ! -z "$STAGED_FILES" ]; then
  TODO_COUNT=$(git diff --cached $STAGED_FILES | grep -c "^\+.*\(TODO\|FIXME\|XXX\|HACK\)" || true)
  if [ $TODO_COUNT -gt 0 ]; then
    echo "‚ö†Ô∏è  Found $TODO_COUNT TODO/FIXME comments in staged files."
    echo "   Consider addressing them or use 'git commit --no-verify' to skip this check."
  fi
fi

# Check for console.log statements
echo "üîç Checking for console statements..."
if [ ! -z "$STAGED_FILES" ]; then
  CONSOLE_COUNT=$(git diff --cached $STAGED_FILES | grep -c "^\+.*console\." || true)
  if [ $CONSOLE_COUNT -gt 0 ]; then
    echo "‚ö†Ô∏è  Found $CONSOLE_COUNT console statements in staged files."
    echo "   Consider removing them or use console.warn/console.error if needed."
  fi
fi

echo "‚úÖ Pre-commit checks completed!"
