# Caeli API Backend

<div alig- âš¡ **High Performance** - Built on Fastify, one of the fastest Node.js frameworks
- ğŸ”’ **Type Safety** - Full TypeScript support with strict type checking
- ğŸ“ **Schema Validation** - Request/response validation with Zod
- ğŸ’¾ **Database** - PostgreSQL with Drizzle ORM for type-safe queries
### Environment Variables

| Variable                      | Description                 | Default       | Required |
| ----------------------------- | --------------------------- | ------------- | -------- | ---------------------------------------------------------------------------------- |
| `PORT`                        | Server port number          | `3000`        | No       |
| `HOST`                        | Server host address         | `0.0.0.0`     | No       |
| `NODE_ENV`                    | Environment mode            | `development` | No       |
| `LOG_LEVEL`                   | Logging level               | `info`        | No       |
| `DATABASE_URL`                | PostgreSQL connection URL   | -             | Yes      |
| `BETTER_AUTH_SECRET`          | Auth encryption secret      | -             | Yes      |
| `BETTER_AUTH_URL`             | Base URL of your app        | -             | Yes      |
| `BETTER_AUTH_TRUSTED_ORIGINS` | CORS trusted origins        | -             | No       |
| `ALLOWED_ORIGINS`             | CORS allowed origins (prod) | `*` (dev)     | No       | hentication\*\* - Better Auth integration with email/password and social providers |

- ğŸ¨ **Custom Logger** - Beautiful ASCII art logo with colorful, emoji-enhanced logging
- ğŸ›¡ï¸ **Error Handling** - Comprehensive error handling with proper HTTP status codes
- ğŸ“Š **Health Checks** - Built-in health endpoints for monitoring and orchestration
- ğŸ³ **Docker Ready** - Full containerization support with docker-compose
- ğŸ”„ **Hot Reload** - Fast development with automatic server restart
- ğŸ¯ **MVC Architecture** - Clean separation of concerns with Models, Controllers, Services
- ğŸ“š **Well Documented** - Comprehensive documentation and examples

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                       â•‘
â•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—                â•‘
â•‘    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘                â•‘
â•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘                â•‘
â•‘    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘                â•‘
â•‘    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘                â•‘
â•‘     â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•                â•‘
â•‘                                                       â•‘
â•‘              ğŸš€ API Server ğŸš€                          â•‘
â•‘                                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**A modern, production-ready Fastify backend API**

[![TypeScript](https://img.shields.io/badge/TypeScript-5.9-blue.svg)](https://www.typescriptlang.org/)
[![Fastify](https://img.shields.io/badge/Fastify-5.6-black.svg)](https://www.fastify.io/)
[![Node.js](https://img.shields.io/badge/Node.js-20+-green.svg)](https://nodejs.org/)
[![pnpm](https://img.shields.io/badge/pnpm-10+-orange.svg)](https://pnpm.io/)

</div>

## ğŸŒŸ Features

- âš¡ **High Performance** - Built on Fastify, one of the fastest Node.js frameworks
- ğŸ”’ **Type Safety** - Full TypeScript support with strict type checking
- ğŸ“ **Schema Validation** - Request/response validation with Zod
- ğŸ’¾ **Database** - PostgreSQL with Drizzle ORM for type-safe queries
- ğŸ¨ **Custom Logger** - Beautiful ASCII art logo with colorful, emoji-enhanced logging
- ğŸ›¡ï¸ **Error Handling** - Comprehensive error handling with proper HTTP status codes
- ğŸ“Š **Health Checks** - Built-in health endpoints for monitoring and orchestration
- ï¿½ **Docker Ready** - Full containerization support with docker-compose
- ï¿½ğŸ”„ **Hot Reload** - Fast development with automatic server restart
- ğŸ¯ **MVC Architecture** - Clean separation of concerns with Models, Controllers, Services
- ğŸ“š **Well Documented** - Comprehensive documentation and examples

## ğŸ“‹ Prerequisites

- **Node.js**: v20 or higher
- **pnpm**: v10 or higher
- **TypeScript**: v5.9 or higher

## ğŸš€ Quick Start

### 1. Installation

```bash
# Navigate to the backend directory
cd apps/backend

# Install dependencies
pnpm install
```

### 2. Database Setup

```bash
# Start PostgreSQL with Docker
docker-compose up -d postgres

# Run database migrations
pnpm db:push
```

ğŸ“– See [SETUP.md](./docs/SETUP.md) for detailed database setup instructions.

### 3. Environment Setup

```bash
# Copy the example environment file
cp .env.example .env

# Edit .env with your configuration
# DATABASE_URL=postgresql://caeli:caeli_password@localhost:5432/caeli_db
# PORT=3000
# NODE_ENV=development
```

### 4. Run the Server

```bash
# Development mode with hot reload
pnpm dev

# Production build
pnpm build

# Start production server
pnpm start
```

### 5. Verify Installation

Visit http://localhost:3000/api/health to see the health check response:

```json
{
  "status": "ok",
  "timestamp": "2025-10-07T12:00:00.000Z",
  "uptime": 123.456,
  "environment": "development",
  "version": "1.0.0",
  "memory": {
    "used": 45,
    "total": 128,
    "unit": "MB"
  }
}
```

## ğŸ“ Project Structure

```
apps/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Application entry point
â”‚   â”œâ”€â”€ models/               # Data models and Zod schemas
â”‚   â”‚   â””â”€â”€ user.model.ts     # User validation schemas
â”‚   â”œâ”€â”€ services/             # Business logic layer
â”‚   â”‚   â””â”€â”€ user.service.ts   # User CRUD operations
â”‚   â”œâ”€â”€ controllers/          # HTTP request handlers
â”‚   â”‚   â””â”€â”€ user.controller.ts # User endpoint handlers
â”‚   â”œâ”€â”€ routes/               # API route definitions
â”‚   â”‚   â”œâ”€â”€ index.ts          # Route registration
â”‚   â”‚   â”œâ”€â”€ health.ts         # Health check endpoints
â”‚   â”‚   â””â”€â”€ user.routes.ts    # User CRUD routes
â”‚   â”œâ”€â”€ db/                   # Database layer
â”‚   â”‚   â”œâ”€â”€ index.ts          # Database connection
â”‚   â”‚   â””â”€â”€ schema/           # Drizzle schemas
â”‚   â”‚       â””â”€â”€ users.schema.ts
â”‚   â””â”€â”€ utils/                # Utility functions
â”‚       â”œâ”€â”€ logger.ts         # Custom logger with ASCII art
â”‚       â””â”€â”€ errors.ts         # Error handling utilities
â”œâ”€â”€ docs/                     # Documentation
â”‚   â”œâ”€â”€ Database.md           # Database setup and usage
â”‚   â”œâ”€â”€ Logger.md             # Logger documentation
â”‚   â”œâ”€â”€ MVC-Flow.md           # MVC architecture flow
â”‚   â”œâ”€â”€ SETUP.md              # Quick setup guide
â”‚   â””â”€â”€ Structure.md          # Architecture details
â”œâ”€â”€ .env.example              # Environment variables template
â”œâ”€â”€ docker-compose.yml        # PostgreSQL container setup
â”œâ”€â”€ Dockerfile                # Production container image
â”œâ”€â”€ drizzle.config.ts         # Drizzle ORM configuration
â”œâ”€â”€ package.json              # Dependencies and scripts
â””â”€â”€ tsconfig.json             # TypeScript configuration
```

ğŸ“– See [Structure.md](./docs/Structure.md) for detailed architecture documentation.

## ğŸ› ï¸ Available Scripts

| Command            | Description                              |
| ------------------ | ---------------------------------------- |
| `pnpm dev`         | Start development server with hot reload |
| `pnpm build`       | Build for production                     |
| `pnpm start`       | Start production server                  |
| `pnpm lint`        | Run ESLint to check code quality         |
| `pnpm lint:fix`    | Fix ESLint errors automatically          |
| `pnpm type-check`  | Run TypeScript compiler to check types   |
| `pnpm clean`       | Remove build artifacts                   |
| `pnpm db:generate` | Generate database migration              |
| `pnpm db:migrate`  | Run database migrations                  |
| `pnpm db:push`     | Push schema changes to database          |
| `pnpm db:studio`   | Open Drizzle Studio (database GUI)       |

## ğŸ“¡ API Endpoints

### Health Checks

| Method | Endpoint            | Description                  |
| ------ | ------------------- | ---------------------------- |
| GET    | `/api/health`       | Comprehensive health check   |
| GET    | `/api/health/live`  | Liveness probe (Kubernetes)  |
| GET    | `/api/health/ready` | Readiness probe (Kubernetes) |

### User Management (CRUD)

| Method | Endpoint         | Description     |
| ------ | ---------------- | --------------- |
| GET    | `/api/users`     | Get all users   |
| GET    | `/api/users/:id` | Get user by ID  |
| POST   | `/api/users`     | Create new user |
| PUT    | `/api/users/:id` | Update user     |
| DELETE | `/api/users/:id` | Delete user     |

### Authentication (Better Auth)

| Method | Endpoint                  | Description          |
| ------ | ------------------------- | -------------------- |
| POST   | `/api/auth/sign-up/email` | Sign up with email   |
| POST   | `/api/auth/sign-in/email` | Sign in with email   |
| POST   | `/api/auth/sign-out`      | Sign out             |
| GET    | `/api/auth/session`       | Get current session  |
| POST   | `/api/auth/verify-email`  | Verify email address |

ğŸ“– See [Auth.md](./docs/Auth.md) for complete authentication documentation.

### Example Request

```bash
# Create a new user
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{
    "name": "John Doe",
    "email": "john@example.com",
    "age": 30
  }'
```

### Example Response

```json
{
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "John Doe",
    "email": "john@example.com",
    "age": 30,
    "createdAt": "2025-10-07T12:00:00.000Z",
    "updatedAt": "2025-10-07T12:00:00.000Z"
  }
}
```

## ğŸ¨ Custom Logger

The Caeli API features a beautiful custom logger with:

- ğŸ¨ **ASCII Art Logo** - Eye-catching "Caeli Api" banner on startup
- ğŸŒˆ **Colorful Output** - Color-coded messages for better readability
- ğŸ˜€ **Emoji Support** - Visual indicators for different log levels
- ğŸ“Š **Server Info** - Detailed startup information display
- ğŸ” **Route Tracking** - Automatic route registration logging

### Logger Example Output

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ Server started successfully!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Address:     http://0.0.0.0:3000
ğŸŒ Environment: development
â° Time:        10/7/2025, 3:45:12 PM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â„¹ï¸  INFO: Registering routes...
ğŸ“Œ Route: GET     /api/health
ğŸ“Œ Route: GET     /api/health/live
ğŸ“Œ Route: GET     /api/health/ready
ğŸ“Œ Route: GET     /api/users
ğŸ“Œ Route: GET     /api/users/:id
ğŸ“Œ Route: POST    /api/users
ğŸ“Œ Route: PUT     /api/users/:id
ğŸ“Œ Route: DELETE  /api/users/:id
âœ… SUCCESS: All routes registered successfully
```

ğŸ“– See [Logger.md](./docs/Logger.md) for complete logger documentation.

## ğŸ›¡ï¸ Error Handling

Comprehensive error handling with:

- **Custom Error Classes** - `ApiError` for application-specific errors
- **Error Factory Functions** - Quick error creation (`createError.notFound()`, etc.)
- **Global Error Handler** - Consistent error response format
- **Validation Errors** - Automatic Zod validation error handling
- **Stack Traces** - Detailed error information in development mode

### Error Response Format

```json
{
  "error": {
    "message": "Resource not found",
    "statusCode": 404,
    "timestamp": "2025-10-07T12:00:00.000Z",
    "path": "/api/users/invalid-id"
  }
}
```

### Using Error Handlers

```typescript
import { createError } from '../utils/errors';

// In your route handler
if (!user) {
  throw createError.notFound('User not found');
}

// Available error types:
// - createError.badRequest()
// - createError.unauthorized()
// - createError.forbidden()
// - createError.notFound()
// - createError.conflict()
// - createError.validationError()
// - createError.internal()
```

## ğŸ”§ Configuration

### Environment Variables

| Variable          | Description                 | Default       | Required |
| ----------------- | --------------------------- | ------------- | -------- |
| `PORT`            | Server port number          | `3000`        | No       |
| `HOST`            | Server host address         | `0.0.0.0`     | No       |
| `NODE_ENV`        | Environment mode            | `development` | No       |
| `LOG_LEVEL`       | Logging level               | `info`        | No       |
| `DATABASE_URL`    | PostgreSQL connection URL   | -             | Yes      |
| `ALLOWED_ORIGINS` | CORS allowed origins (prod) | `*` (dev)     | No       |

### CORS Configuration

In development, CORS is wide open (`*`). For production, set `ALLOWED_ORIGINS`:

```env
ALLOWED_ORIGINS=https://example.com,https://app.example.com
```

## ğŸ—ï¸ Building New Features

### Adding a New Route Module

1. Create a new route file:

```typescript
// src/routes/users.ts
import type { FastifyInstance } from 'fastify';
import { customLogger } from '../utils/logger';

/**
 * User route handlers
 * @param {FastifyInstance} app - Fastify instance
 */
export async function userRoutes(app: FastifyInstance): Promise<void> {
  app.get('/', async (request, reply) => {
    return { users: [] };
  });

  customLogger.route('GET', '/api/users');
}
```

2. Register in `src/routes/index.ts`:

```typescript
import { userRoutes } from './users';

// In the registerRoutes function
await api.register(userRoutes, { prefix: '/users' });
```

### Adding Validation with Zod

```typescript
import { z } from 'zod';

const userSchema = z.object({
  name: z.string().min(2).max(100),
  email: z.string().email(),
  age: z.number().int().min(18).optional(),
});

type CreateUserBody = z.infer<typeof userSchema>;

app.post<{ Body: CreateUserBody }>('/', {
  schema: {
    body: userSchema,
  },
  handler: async (request, reply) => {
    const userData = request.body; // Fully typed!
    // Your logic here
  },
});
```

## ğŸ³ Docker Support

The project includes full Docker support with PostgreSQL database:

```bash
# Start PostgreSQL database
docker-compose up -d

# Build and run the backend in Docker
docker build -t caeli-api .
docker run -p 3000:3000 --env-file .env caeli-api
```

See [Database.md](./docs/Database.md) for detailed database setup instructions.

## ğŸ“Š Monitoring & Observability

### Health Check Endpoints

Perfect for container orchestration:

- **Liveness**: `/api/health/live` - Is the service alive?
- **Readiness**: `/api/health/ready` - Can it accept traffic?

### Logging

- **Development**: Pretty-printed, colorful logs with emojis
- **Production**: Structured JSON logs for log aggregation services

```json
{
  "level": 30,
  "time": 1696694400000,
  "msg": "Server listening at http://0.0.0.0:3000",
  "reqId": "req-1"
}
```

## ğŸ’¾ Database

PostgreSQL database with Drizzle ORM:

- **Type-safe queries** with Drizzle ORM
- **Schema migrations** with Drizzle Kit
- **Docker support** with docker-compose
- **Connection pooling** for performance

```bash
# Run migrations
pnpm db:migrate

# Generate new migration
pnpm db:generate

# Open Drizzle Studio
pnpm db:studio
```

ğŸ“– See [Database.md](./docs/Database.md) for complete database documentation.

## ğŸ” Authentication

Better Auth integration for modern, secure authentication:

- **Email & Password** - Traditional authentication
- **Social Providers** - GitHub, Google, and more
- **Session Management** - Secure, automatic session handling
- **Type-Safe** - Full TypeScript support with Drizzle ORM

```bash
# Sign up a new user
curl -X POST http://localhost:3000/api/auth/sign-up/email \
  -H "Content-Type: application/json" \
  -d '{
    "name": "John Doe",
    "email": "john@example.com",
    "password": "SecurePassword123!"
  }'

# Sign in
curl -X POST http://localhost:3000/api/auth/sign-in/email \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "password": "SecurePassword123!"
  }'
```

ğŸ“– See [Auth.md](./docs/Auth.md) for complete authentication setup and usage.

## ğŸ¤ Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“ Code Style

- **TypeScript** with strict mode enabled
- **ESLint** for code quality
- **JSDoc** comments for all public functions
- **Prettier** for code formatting (inherited from workspace)

## ğŸ“ Learning Resources

- [Fastify Documentation](https://www.fastify.io/docs/latest/)
- [Zod Documentation](https://zod.dev/)
- [Pino Logger](https://getpino.io/)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)

## ğŸ“„ License

This project is part of the Caeli monorepo.

## ğŸ‘¥ Authors

Caeli Studio

---

<div align="center">

**Built with â¤ï¸ using Fastify, TypeScript, PostgreSQL, Drizzle ORM, and Better Auth**

[Documentation](./docs/Structure.md) â€¢ [Database Setup](./docs/Database.md) â€¢ [Authentication](./docs/Auth.md) â€¢ [Logger Docs](./docs/Logger.md) â€¢ [Report Bug](../../issues) â€¢ [Request Feature](../../issues)

</div>
