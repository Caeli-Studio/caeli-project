#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the previous and new commit hashes
prev_head=$1
new_head=$2
branch_checkout=$3

# Only run on branch checkout (not file checkout)
if [ "$branch_checkout" = "1" ]; then
  echo "ðŸ”„ Branch checkout detected..."

  # Check if package.json or pnpm-lock.yaml changed
  if git diff --name-only $prev_head $new_head | grep -E "(package\.json|pnpm-lock\.yaml|yarn\.lock|package-lock\.json)" > /dev/null; then
    echo "ðŸ“¦ Dependencies may have changed. Consider running:"
    echo "   pnpm install"
    echo ""
  fi

  # Check if .env.example changed
  if git diff --name-only $prev_head $new_head | grep -E "\.env\.example" > /dev/null; then
    echo "ðŸ”§ Environment variables may have changed. Check:"
    echo "   .env.example"
    echo ""
  fi

  # Show helpful branch information
  current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')
  echo "âœ… Switched to branch: $current_branch"

  # Show recent commits on this branch
  echo "ðŸ“‹ Recent commits on this branch:"
  git log --oneline -5
fi
